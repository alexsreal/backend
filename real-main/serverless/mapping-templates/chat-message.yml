- type: ChatMessage
  field: authorUserId
  dataSource: NoneDataSource
  response: PassThru.response.vtl

- type: ChatMessage
  field: chat
  request: ChatMessage.chat/before.request.vtl
  response: ChatMessage.chat/after.response.vtl
  kind: PIPELINE
  functions:
    - Chats.batchGet
  caching:
    keys:
      - $context.source.chatId
    ttl: 3600

- type: ChatMessage
  field: textTaggedUsers
  request: Source.textTaggedUsers/before.request.vtl
  response: Source.textTaggedUsers/after.response.vtl
  kind: PIPELINE
  functions:
    - Users.batchGet
    - Users.batchGet.blockerStatus
    - Users.filterBy.blockerStatus
    - Users.batchGet.followedStatus
  caching:
    keys:
      - $context.identity.cognitoIdentityId
      - $context.source.textTags

- type: ChatMessage
  field: viewedStatus
  dataSource: DynamodbDataSource
  caching:
    keys:
      - $context.identity.cognitoIdentityId
      - $context.source.chatId  # ChatMessage.viewedStatus is chat-wide, apparently

- type: ChatMessage
  field: flagStatus
  dataSource: DynamodbDataSource
  caching:
    keys:
      - $context.identity.cognitoIdentityId
      - $context.source.messageId
